{% extends "base.html" %}

{% block title %}Upload Files | FileShare Hub{% endblock %}

{% block content %}
<style>
  .card.file-tile {
    font-size: 0.9rem;
    border-radius: 1rem;
  }

  .card.file-tile h5 {
    font-size: 1rem;
  }

  .card.file-tile .card-body {
    padding: 1rem;
  }

  .card.file-tile .card-footer {
    padding: 0.75rem 1rem;
  }

  .card.file-tile i {
    font-size: 1.1rem;
  }

  .small-text-muted {
    font-size: 0.78rem;
    color: #6c757d;
  }

  .card-header-upload {
    background-color: #0d6efd;
    color: white;
    font-weight: 600;
    font-size: 1.3rem;
    border-radius: 1rem 1rem 0 0;
    padding: 0.75rem 1.25rem;
    margin-bottom: 1rem;
  }

  .card-header-files {
    background-color: #198754;
    color: white;
    font-weight: 600;
    font-size: 1.3rem;
    border-radius: 1rem 1rem 0 0;
    padding: 0.75rem 1.25rem;
    margin-bottom: 1rem;
  }

  .files-list-scroll {
    overflow-y: auto;
    flex-grow: 1;
    min-height: 0;
    max-height: 450px;
    padding-right: 0.5rem;
  }
</style>

<div class="container mt-5">
  <div class="row g-4">
    <!-- Upload Card -->
    <div class="col-md-5 d-flex flex-column">
      <div class="card shadow-sm rounded p-4 flex-grow-1">
        <div class="card-header-upload">Upload a File</div>
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="mb-3">
            <label for="id_file" class="form-label">Choose a file</label>
            {{ form.file }}
          </div>
          <div class="mb-3">
            <label for="id_description" class="form-label">Description</label>
            {{ form.description }}
          </div>
          <button type="submit" class="btn btn-primary">Upload</button>
        </form>
      </div>
    </div>

    <!-- Recently Uploaded Card -->
    {% if files %}
    <div class="col-md-7 d-flex flex-column">
      <div class="card shadow-sm rounded p-3 flex-grow-1 d-flex flex-column">
        <div class="card-header-files">Recently Uploaded Files</div>
        <div class="files-list-scroll mt-2">
          <div class="row row-cols-1 row-cols-sm-2 g-3">
            {% for file in files %}
            <div class="col">
              <div class="card h-100 shadow-sm file-tile">
                <div class="card-body">
                  <h5 class="text-primary fw-semibold mb-2">
                    <i class="bi bi-file-earmark-text me-1"></i>
                    {{ file.file.name|cut:"uploads/" }}
                  </h5>
                  <p class="small-text-muted mb-2">
                    üë§ Uploaded by <strong>{{ file.uploaded_by.username }}</strong><br>
                    üìÖ Uploaded: {{ file.uploaded_at|date:"F d, Y @ h:i A" }}<br>
                    {% if file.updated_at != file.uploaded_at %}
                    üîÅ Reuploaded: {{ file.updated_at|date:"F d, Y @ h:i A" }}
                    {% endif %}
                  </p>
                </div>
                <div class="card-footer bg-transparent border-top-0 text-end">
                  <a href="{{ file.file.url }}" class="btn btn-sm btn-outline-primary" download>
                    <i class="bi bi-download"></i> Download
                  </a>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
